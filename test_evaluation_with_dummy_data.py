import asyncio
import json
from datetime import datetime
from typing import List, Dict, Any

from services.evaluation_service_clean import EvaluationService


class DummyDataGenerator:
    """ì‹¤ì œ CPX ëŒ€í™” ê¸°ë°˜ ë”ë¯¸ ë°ì´í„° ìƒì„±ê¸°"""
    
    def __init__(self):
        self.evaluation_service = EvaluationService()
        
    def generate_memory_loss_conversation(self) -> list:
        """ì‹¤ì œ ì˜ì‚¬-í™˜ì ëŒ€í™” ìŒ (test_script_client ê¸°ë°˜, SER ë¶„ì„ ì™„ë£Œ)"""
        
        # ì‹¤ì œ CPX ëŒ€í™” ìŒ ë°ì´í„°
        conversation_pairs = [
            ("ì•ˆë…•í•˜ì„¸ìš”. ì €ëŠ” ì‹ ê²½ê³¼ë¼ê³  í•©ë‹ˆë‹¤.", "ë„¤, ì•ˆë…•í•˜ì„¸ìš”."),
            ("í™˜ìë¶„ ì„±í•¨ê³¼ ë‚˜ì´, ë“±ë¡ë²ˆí˜¸ê°€ ì–´ë–»ê²Œ ë˜ì„¸ìš”?", "ê¹€ì˜í¬, 75ì„¸ì…ë‹ˆë‹¤. ë“±ë¡ë²ˆí˜¸ëŠ” 1234567ì…ë‹ˆë‹¤."),
            ("ë„¤, ì–´ë–»ê²Œ ì˜¤ì…¨ì–´ìš”?", "ìš”ì¦˜ ê¸°ì–µë ¥ì´ ë§ì´ ë–¨ì–´ì§€ëŠ” ê²ƒ ê°™ì•„ì„œ ì™”ìŠµë‹ˆë‹¤."),
            ("ê¸°ì–µë ¥ì´ ë–¨ì–´ì§€ì‹œëŠ” ê²ƒ ê°™ë‹¤. ê·¸ëŸ¬ë©´ ê·¸ê²Œ ì–¸ì œë¶€í„° ê·¸ëŸ¬ì‹œëŠ” ê±°ì£ ?", "í•œ 6ê°œì›” ì „ë¶€í„° ì‹¬í•´ì§„ ê²ƒ ê°™ì•„ìš”."),
            ("ê·¸ëŸ¬ë©´ ì–´ë–»ê²Œ ê¹œë¹¡í•˜ì‹œê³  ê¸°ì–µë ¥ì´ ë–¨ì–´ì§€ì‹œëŠ”ì§€ í¸í•˜ê²Œ ì–˜ê¸° í•œë²ˆ í•´ë³´ì‹œê² ì–´ìš”?", "ë°©ê¸ˆ ë­˜ í•˜ë ¤ê³  í–ˆëŠ”ì§€ ê¹Œë¨¹ê³ , ë¬¼ê±´ì„ ì–´ë”” ë’€ëŠ”ì§€ ìê¾¸ ìŠì–´ë²„ë ¤ìš”."),
            ("ê·¸ëŸ¬ë©´ ê·¸ê²Œ ì´ì œ ë¹„êµì  ìµœê·¼ì˜ ì¼ë“¤ì„ ì˜ ê¹Œë¨¹ìœ¼ì‹œë‚˜ìš”? ì•„ë‹ˆë©´ ì˜›ë‚  ì¼ë„ ë§ì´ ìŠì–´ë²„ë¦¬ì‹œë‚˜ìš”?", "ìµœê·¼ ì¼ë“¤ì„ ë” ë§ì´ ê¹Œë¨¹ëŠ” ê²ƒ ê°™ì•„ìš”. ì˜›ë‚  ì¼ì€ ê¸°ì–µë‚˜ëŠ”ë°."),
            ("ê·¸ëŸ¬ë©´ í˜¹ì‹œ ìµœê·¼ì— ì„±ê²© ë³€í™” ê°™ì€ ê±´ ì—†ìœ¼ì„¸ìš”? ê¸‰í•´ì§€ê±°ë‚˜ ì§œì¦ì´ ë‚˜ê±°ë‚˜ ë§ì´ ë‹¤íˆ¬ì‹œê±°ë‚˜ ê·¸ëŸ° ê±´?", "ì˜ˆì „ë³´ë‹¤ ì§œì¦ì´ ë§ì´ ë‚˜ëŠ” ê²ƒ ê°™ì•„ìš”."),
            ("ë¬¼ê±´ ì´ë¦„ì´ë‚˜ ë‹¨ì–´ ê°™ì€ ê±° ìƒê°ì´ ì˜ ì•ˆë‚˜ê±°ë‚˜ ë§í•˜ëŠ” ê²Œ ì¢€ ì–´ë‘”í•˜ê±°ë‚˜ ê·¸ëŸ°ê±´ ì—†ìœ¼ì„¸ìš”?", "ë„¤, ê°€ë” ë‹¨ì–´ê°€ ìƒê°ì´ ì•ˆ ë‚  ë•Œê°€ ìˆì–´ìš”."),
            ("ìµœê·¼ì— ê¸¸ì„ ìƒì–´ë²„ë ¸ë‹¤ê±°ë‚˜ ë‹¤ë‹ˆë˜ ê¸¸ì¸ë° ì˜ ëª¨ë¥´ê² ë‹¤ê±°ë‚˜ ê·¸ëŸ° ì ì€ ì—†ìœ¼ì„¸ìš”?", "ì•„ì§ê¹Œì§€ëŠ” ê¸¸ì„ ìƒì–´ë²„ë¦° ì ì€ ì—†ì–´ìš”."),
            ("ê³„ì‚°ì€ ì˜ í•˜ì„¸ìš”? ì˜ˆë¥¼ ë“¤ë©´ ë¬¼ê±´ ì‚´ ë•Œ ëˆ ë‚´ëŠ” ê±° ê·¸ëŸ° ê±°?", "ê³„ì‚°ì€ ì•„ì§ ê´œì°®ì€ ê²ƒ ê°™ì•„ìš”."),
            ("ì•Œê² ìŠµë‹ˆë‹¤. ì¼ë‹¨ì€ ê¸°ì–µë ¥ë„ ë–¨ì–´ì§€ì‹œëŠ” ê²ƒ ê°™ì€ë° ì¼ìƒìƒí™œì„ í•  ë•Œ ê·¸ ê¸°ì–µë ¥ ë•Œë¬¸ì— ë¬¸ì œê°€ ë˜ê±°ë‚˜ ê·¸ëŸ° ì¼ìƒìƒí™œì— ì¥ì• ê°€ ìˆìœ¼ì„¸ìš”?", "ê°€ë” ìš”ë¦¬í•  ë•Œ ê°€ìŠ¤ë¶ˆ ë„ëŠ” ê±¸ ê¹œë¹¡í•´ì„œ ê±±ì •ì´ì—ìš”."),
            ("ì˜ˆë¥¼ ë“¤ë©´ ì§ì¥ìƒí™œì—ì„œ ê¸°ì–µì„ ëª» í•´ê°€ì§€ê³  ì‹¤ì œë¡œ ìƒì‚¬ì™€ ë¬¸ì œê°€ ë˜ì—ˆê±°ë‚˜ ì•„ë‹ˆë©´ ì€í–‰ì„ ë³´ëŠ”ë° ê·¸ê²Œ ë¬¸ì œê°€ ë˜ì—ˆê±°ë‚˜ ê·¸ëŸ° ê²Œ ìˆìœ¼ì„¸ìš”?", "ì€í‡´í•´ì„œ ì§ì¥ì€ ì•ˆ ë‹¤ë‹ˆì§€ë§Œ, ì€í–‰ ì—…ë¬´ëŠ” ì•„ì§ ê´œì°®ì•„ìš”."),
            ("ì¹œêµ¬ì™€ ì•½ì† ê°™ì€ ê±°ëŠ” ê¹œë¹¡í•˜ì‹œê±°ë‚˜ ê·¸ëŸ° ì ì€ ìˆìœ¼ì„¸ìš”?", "ë„¤, ê°€ë” ì•½ì†ì„ ê¹œë¹¡í•  ë•Œê°€ ìˆì–´ìš”."),
            ("ì¡°ê¸ˆì€ ìˆìœ¼ì‹ ë° ì•½ê°„ ì• ë§¤í•˜ì‹œë‹¤. ì•Œê² ìŠµë‹ˆë‹¤.", "ë„¤."),
            ("ê°€ì¡± ì¤‘ì—ì„œ í˜¹ì‹œ ì¹˜ë§¤ í™˜ìê°€ ìˆìœ¼ì„¸ìš”?", "ì–´ë¨¸ë‹ˆê»˜ì„œ ì¹˜ë§¤ë¥¼ ì•“ìœ¼ì…¨ì–´ìš”."),
            ("ëª‡ ì‚´ ë•Œ ì •ë„ ê·¸ëŸ¬ì…¨ì–´ìš”?", "80ì„¸ì¯¤ë¶€í„° ì‹œì‘ë˜ì…¨ë˜ ê²ƒ ê°™ì•„ìš”."),
            ("í™˜ìë¶„ì€ ë‹¹ë‡¨, ê³ í˜ˆì••, í˜‘ì‹¬ì¦ ê°™ì€ í˜ˆê´€ì„± ì§ˆí™˜ì´ ìˆìœ¼ì„¸ìš”?", "ê³ í˜ˆì••ì´ ìˆì–´ì„œ ì•½ì„ ë¨¹ê³  ìˆì–´ìš”."),
            ("ê·¸ê±° ë§ê³ ëŠ” ë­ ìš°ìš¸ì¦ì´ë‚˜ ì§„í†µì œë‚˜ ë‹¤ë¥¸ ì•½ ê°™ì€ ê±° ë“œì‹œëŠ” ê±´ ì—†ìœ¼ì„¸ìš”?", "ìš°ìš¸ì¦ì•½ì€ ì•ˆ ë¨¹ê³  ìˆì–´ìš”."),
            ("ëª¸ì´ ë§ì´ í”¼ê³¤í•˜ê±°ë‚˜ ìµœê·¼ì— ìµœê·¼ì— ëª¸ë¬´ê²Œê°€ ë§ì´ ì°Œê±°ë‚˜ ì•„ë‹ˆë©´ ê°‘ìƒì„  ì§ˆí™˜ ê°™ì€ ê²ƒë„ ì—†ìœ¼ì‹œê³ ìš”?", "ëª¸ë¬´ê²ŒëŠ” ë¹„ìŠ·í•˜ê³  ê°‘ìƒì„ ì€ ê´œì°®ì•„ìš”."),
            ("ìµœê·¼ì— ìš°ìš¸í•¨ì´ ë§ì´ ì‹¬í•˜ê±°ë‚˜ ì˜ìš•ì´ ì—†ê±°ë‚˜ ê·¸ëŸ° ê²Œ ìˆìœ¼ì„¸ìš”?", "ê°€ë” ìš°ìš¸í•  ë•Œê°€ ìˆì–´ìš”."),
            ("í˜¹ì‹œ í™˜ê° ê°™ì€ í—›ê°œë¹„ê°€ ë³´ì´ê±°ë‚˜ ì—‰ëš±í•œ í–‰ë™ì„ í•˜ê±°ë‚˜ ì´ìƒí•œ ì†Œë¦¬ í•œ ë²ˆì”© í•˜ì‹œëŠ” ê±´ ì—†ìœ¼ì„¸ìš”?", "ê·¸ëŸ° ê±´ ì—†ì–´ìš”."),
            ("ì†ì´ ë–¨ë¦¬ê±°ë‚˜ ëª¸ì´ ë»£ë»£í•˜ê±°ë‚˜ ëŠë ¤ì§€ëŠ” ê±´ ì—†ìœ¼ì„¸ìš”?", "ê·¸ëŸ° ê±´ ì—†ì–´ìš”."),
            ("ê±¸ìŒê±¸ì´ê°€ ì¢…ì¢… ê±¸ì—ˆê±°ë‚˜ ë¶ˆí¸í•˜ì‹œê±°ë‚˜ ì•„ë‹ˆë©´ ì†Œë³€ ì¡°ì ˆì´ ì˜ ì•ˆ ë˜ì‹œëŠ” ë¶ˆí¸í•¨ì€ ì—†ìœ¼ì„¸ìš”?", "ì•„ì§ê¹Œì§€ëŠ” ê´œì°®ì•„ìš”."),
            ("í‰ì†Œì— ìˆ  ë§ì´ ë“œì‹œëŠ” í¸ì´ì„¸ìš”?", "ê±°ì˜ ì•ˆ ë§ˆì…”ìš”."),
            ("í˜¹ì‹œ ë¨¸ë¦¬ë¥¼ ë‹¤ì¹˜ì‹œê±°ë‚˜ ë‡Œì—¼ ê°™ì€ ê±° ë‡Œì§ˆí™˜ ì•“ì€ ì ì€ ì—†ìœ¼ì„¸ìš”?", "ì—†ì–´ìš”."),
            ("ì•Œê² ìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë©´ ì œê°€ ì´ì œ ì‹ ì²´ ì§„ì°°ì„ í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.", "ë„¤."),
            ("ì´ì œ ì§„ì°°ì€ ëë‚¬ê³ ìš” í˜¹ì‹œ ê±±ì •ë˜ëŠ” ê±° ìˆìœ¼ì„¸ìš”?", "ì¹˜ë§¤ê°€ ë§ëŠ” ê±´ê°€ìš”?"),
            ("ìŒ ì¼ë‹¨ì€ ê°€ì¡±ë ¥ì´ ìˆìœ¼ì‹œê³  ë˜ ê¸°ì–µë ¥ì´ ë–¨ì–´ì§€ì‹œëŠ” ê²ƒ ë•Œë¬¸ì— ì¹˜ë§¤ì˜ ê°€ì¥ í”í•œ ìœ í˜•ì¸ ì•Œì¸ í•˜ì´ë¨¸ ì¹˜ë§¤ ê°€ëŠ¥ì„±ì„ ê³ ë ¤í•˜ê¸´ í•´ì•¼ ë  ê²ƒ ê°™ìŠµë‹ˆë‹¤", "ë„¤."),
            ("í•˜ì§€ë§Œ ê·¸ ê·¹ì‹¬í•œ ìŠ¤íŠ¸ë ˆìŠ¤ ë•Œë¬¸ì— ìµœê·¼ì— ìš°ìš¸ì¦ ì¦ìƒì´ ì¢€ ìˆì–´ ë³´ì´ì…”ì„œ ìš°ìš¸ì¦ì— ì˜í•œ ê°€ì„± ì¹¨í•´ì˜ ê°€ëŠ¥ì„±ë„ ê³ ë ¤í•´ì•¼ í•©ë‹ˆë‹¤.", "ë„¤."),
            ("ë˜ ì¡°ê¸ˆ ê°€ëŠ¥ì„±ì´ ë†’ì§€ëŠ” ì•Šì§€ë§Œ ê³ í˜ˆì••ì´ ìˆê³  ê³ í˜ˆì•• ì¡°ì ˆì´ ì•ˆë˜ì‹œëŠ” ê²ƒìœ¼ë¡œ ë´ì„œëŠ” í˜ˆê´€ì„± ì¹˜ë§¤ ê°€ëŠ¥ì„±ë„ í•¨ê»˜ ê³ ë ¤í•´ì•¼ í•  ê²ƒ ê°™ìŠµë‹ˆë‹¤.", "ë„¤."),
            ("ì¼ë‹¨ í”¼ê²€ì‚¬ë¥¼ í•  ê±°ê³ ìš”. ê·¸ë¦¬ê³  ì¸ì§€ê¸°ëŠ¥ ê²€ì‚¬ ìì„¸í•˜ê²Œ í•˜ê³  ë‡Œ MRIë¥¼ ì°ì–´ì„œ ì •í™•í•œ ì´ìœ ì™€ ì›ì¸ì„ í™•ì¸í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.", "ë„¤, ì•Œê² ìŠµë‹ˆë‹¤."),
            ("ê²½ë„ì¸ì§€ì¥ì• ì™€ ì¹˜ë§¤ëŠ” ë‘˜ ë‹¤ ì¸ì§€ê¸°ëŠ¥, ê¸°ì–µë ¥ì´ë‚˜ ì–¸ì–´ëŠ¥ë ¥ì´ë‚˜ íŒë‹¨ë ¥ ê°™ì€ ì¸ì§€ê¸°ëŠ¥ì´ ë–¨ì–´ì§€ëŠ” ê²ƒì€ ë§ëŠ”ë°", "ë„¤."),
            ("ì¹˜ë§¤ëŠ” ê·¸ë¡œ ì¸í•œ ì¸ì§ˆê¸°ëŠ¥ ì €í•˜ ë•Œë¬¸ì— ì¼ìƒìƒí™œì— ì¥ì• ê°€ ìˆëŠ” ê²ƒì„ ì¹˜ë§¤ë¼ê³  ë§í•˜ê³ ìš”. ì¼ìƒìƒí™œì— ì¥ì• ê°€ ì—†ëŠ” ë‹¨ê³„ë¥¼ ê²½ë„ì¸ì§€ì €í•˜ë¼ê³  ì¹˜ë§¤ ì „ ë‹¨ê³„ ì •ë„ë¡œ ìƒê°í•˜ê³  ìˆìŠµë‹ˆë‹¤.", "ë„¤, ì•Œê² ìŠµë‹ˆë‹¤."),
            ("í˜¹ì‹œ ë˜ ë‹¤ë¥¸ ê¶ê¸ˆí•œ ê±° ìˆìœ¼ì„¸ìš”?", "ì—†ì–´ìš”."),
            ("ë„¤. ê·¸ëŸ¬ë©´ ê²€ì‚¬ í›„ì— ëµ™ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤. ì¡°ì‹¬í•´ì„œ ê°€ì„¸ìš”.", "ë„¤, ê°ì‚¬í•©ë‹ˆë‹¤.")
        ]
        
        conversations = []
        
        # ì‹¤ì œ ëŒ€í™” ìŒì„ SER ë¶„ì„ ì™„ë£Œëœ í˜•íƒœë¡œ ë³€í™˜
        for i, (doctor_text, patient_text) in enumerate(conversation_pairs):
            # ì˜ì‚¬ ë°œì–¸ (SER ê°ì • ë¶„ì„ í¬í•¨)
            doctor_entry = {
                "content": doctor_text,
                "role": "doctor",
                "emotion_analysis": self._generate_doctor_emotion(i),
                "timestamp": datetime.now().isoformat(),
                "audio_file_path": f"dummy_doctor_{i:02d}.wav"
            }
            conversations.append(doctor_entry)
            
            # í™˜ì ì‘ë‹µ (SER ë¶„ì„ ì—†ìŒ)
            patient_entry = {
                "content": patient_text,
                "role": "patient",
                "emotion_analysis": None,
                "timestamp": datetime.now().isoformat(),
                "audio_file_path": f"dummy_patient_{i:02d}.wav"
            }
            conversations.append(patient_entry)
            
        return conversations

    def _generate_doctor_emotion(self, index: int) -> dict:
        """ì˜ì‚¬ ë°œì–¸ì— ëŒ€í•œ SER ê°ì • ë¶„ì„ ê²°ê³¼ ìƒì„±"""
        
        # ì‹¤ì œ SER ë¶„ì„ê³¼ ìœ ì‚¬í•œ íŒ¨í„´ìœ¼ë¡œ ìƒì„±
        emotion_patterns = [
            {"predicted_emotion": "Kind", "confidence": 0.87, "emotion_scores": {"Anxious": 0.05, "Dry": 0.08, "Kind": 0.87}},
            {"predicted_emotion": "Dry", "confidence": 0.72, "emotion_scores": {"Anxious": 0.15, "Dry": 0.72, "Kind": 0.13}},
            {"predicted_emotion": "Kind", "confidence": 0.84, "emotion_scores": {"Anxious": 0.08, "Dry": 0.08, "Kind": 0.84}},
            {"predicted_emotion": "Anxious", "confidence": 0.68, "emotion_scores": {"Anxious": 0.68, "Dry": 0.22, "Kind": 0.10}},
            {"predicted_emotion": "Kind", "confidence": 0.81, "emotion_scores": {"Anxious": 0.09, "Dry": 0.10, "Kind": 0.81}},
            {"predicted_emotion": "Dry", "confidence": 0.75, "emotion_scores": {"Anxious": 0.12, "Dry": 0.75, "Kind": 0.13}}
        ]
        
        return emotion_patterns[index % len(emotion_patterns)]

    async def run_evaluation_test(self):
        """ë”ë¯¸ ë°ì´í„°ë¡œ í‰ê°€ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸"""
        
        # 1. ë”ë¯¸ ëŒ€í™” ë°ì´í„° ìƒì„±
        print("ğŸ­ ì‹¤ì œ CPX ëŒ€í™” ê¸°ë°˜ ë”ë¯¸ ë°ì´í„° ìƒì„± ì¤‘...")
        conversations = self.generate_memory_loss_conversation()
        print(f"âœ… {len(conversations)}ê°œ ëŒ€í™” í•­ëª© ìƒì„± ì™„ë£Œ")
        
        # 2. í‰ê°€ ì‹¤í–‰
        print("\nğŸ” LangGraph ê¸°ë°˜ í‰ê°€ ì‹œìŠ¤í…œ ì‹¤í–‰ ì¤‘...")
        
        try:
            # í…ŒìŠ¤íŠ¸ ì„¸ì…˜ ìƒì„±
            session_id = await self.evaluation_service.start_evaluation_session(
                user_id="1",
                scenario_id="1"
            )
            
            # ëŒ€í™” ë°ì´í„°ë¥¼ ì„¸ì…˜ì— ì¶”ê°€
            for conversation in conversations:
                await self.evaluation_service.add_conversation_entry(
                    session_id=session_id,
                    audio_file_path="test_audio.wav",  # í…ŒìŠ¤íŠ¸ìš© ë”ë¯¸ íŒŒì¼
                    text=conversation.get("content", ""),
                    role=conversation.get("role", "doctor"),
                    emotion_analysis=None
                )
            
            # ì¢…í•© í‰ê°€ ì‹¤í–‰
            evaluation_result = await self.evaluation_service.end_evaluation_session(session_id)
            
            print("âœ… í‰ê°€ ì™„ë£Œ!")
            
            return evaluation_result
            
        except Exception as e:
            print(f"âŒ í‰ê°€ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜: {e}")
            return None

    def generate_conversation_summary(self, conversations: List[Dict]) -> Dict:
        """ëŒ€í™” ìš”ì•½ í†µê³„ ìƒì„±"""
        
        doctor_messages = [c for c in conversations if c["role"] == "doctor"]
        patient_messages = [c for c in conversations if c["role"] == "patient"]
        
        # ê°ì • ë¶„ì„ í†µê³„
        emotion_stats = {"Kind": 0, "Dry": 0, "Anxious": 0}
        for msg in doctor_messages:
            if msg.get("emotion_analysis"):
                emotion = msg["emotion_analysis"]["predicted_emotion"]
                emotion_stats[emotion] += 1
        
        return {
            "total_exchanges": len(conversations) // 2,
            "doctor_messages": len(doctor_messages),
            "patient_messages": len(patient_messages),
            "emotion_distribution": emotion_stats,
            "conversation_duration": "ì•½ 15ë¶„ (ì¶”ì •)",
            "cpx_stages": {
                "history_taking": "1-24ë²ˆ ëŒ€í™” (ë³‘ë ¥ì²­ì·¨)",
                "physical_examination": "25ë²ˆ ëŒ€í™” (ì‹ ì²´ì§„ì°°)",
                "patient_education": "26-32ë²ˆ ëŒ€í™” (í™˜ìêµìœ¡)"
            }
        }


async def main():
    """ë©”ì¸ í…ŒìŠ¤íŠ¸ ì‹¤í–‰"""
    
    print("ğŸ¥ CPX í‰ê°€ ì‹œìŠ¤í…œ ë”ë¯¸ ë°ì´í„° í…ŒìŠ¤íŠ¸")
    print("=" * 50)
    
    generator = DummyDataGenerator()
    
    # 1. ë”ë¯¸ ëŒ€í™” ìƒì„±
    conversations = generator.generate_memory_loss_conversation()
    
    # 2. í‰ê°€ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸
    print("\n" + "=" * 50)
    evaluation_result = await generator.run_evaluation_test()
    
    if evaluation_result:
        print("\nğŸ¯ í…ŒìŠ¤íŠ¸ ì„±ê³µ! ì‹¤ì œ CPX ëŒ€í™” ê¸°ë°˜ í‰ê°€ ì‹œìŠ¤í…œì´ ì •ìƒ ì‘ë™í•©ë‹ˆë‹¤.")
        
        # ê²°ê³¼ íŒŒì¼ ì €ì¥
        result_filename = f"cpx_demo_evaluation_{int(datetime.now().timestamp())}.json"
        with open(f"evaluation_results/{result_filename}", "w", encoding="utf-8") as f:
            json.dump({
                "conversations": conversations,
                "evaluation_result": evaluation_result
            }, f, indent=2, ensure_ascii=False)
        
        print(f"ğŸ“ ê²°ê³¼ ì €ì¥: evaluation_results/{result_filename}")
    else:
        print("\nâŒ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨")


if __name__ == "__main__":
    asyncio.run(main())